---
import Button from "../components/Button.astro";
import GeodeLogo from "../components/GeodeLogo.astro";
import Link from "../components/Link.astro";
import Paragraph from "../components/Paragraph.astro";
import Row from "../components/Row.astro";
import Title from "../components/Title.astro";
import Base from "../layouts/Base.astro";
import Column from "../components/Column.astro";
import IconLink from "../components/IconLink.astro";
import DotSeparator from "../components/DotSeparator.astro";
import Icon from "../components/Icon.astro";
import mainPageImg from '../images/main-page.png';
import Image from "../components/Image.astro";
import Gap from "../components/Gap.astro";
import Padding from "../components/Padding.astro";
import Waves from "../components/Waves.astro";
import Background from "../components/Background.astro";
import MoneyBox from "../components/MoneyBox.astro";
import ModCollage from "../components/ModCollage.astro";
import CodeExample from "../components/CodeExample.astro";
import ShowcaseCollage from "../components/ShowcaseCollage.astro";
---

<Base>
	<Waves anchor="top"/>
	<Padding>
		<Column>
			<Row>
				<GeodeLogo plain={true} mono={true}/>
				<Title>Geode</Title>
			</Row>
			<Paragraph style="subtitle">
				<span>Bringing <em>mod support</em> to </span>
				<Gap size="small"/>
				<IconLink href="https://store.steampowered.com/app/322170/Geometry_Dash/" style="subtitle"><Icon type="gd"/>Geometry Dash</IconLink>
			</Paragraph>
			<Gap size="0"/>
			<Row>
				<Button href="/install" type="primary-black filled"><Icon type="download"/>Download</Button>
				<Button href="/mods" type="primary-black filled"><Icon type="browse"/>Browse Mods</Button>
			</Row>
		</Column>
	</Padding>
	<Image src={mainPageImg} alt="The main page" style="shadow"></Image>
	<Row>
		<IconLink href="https://discord.gg/9e43WMKzhp"><Icon type="discord" size="small"/>Discord</IconLink>
		<DotSeparator/>
		<IconLink href="https://twitter.com/geode_sdk"><Icon type="twitter" size="small"/>Twitter</IconLink>
		<DotSeparator/>
		<IconLink href="https://docs.geode-sdk.org/"><Icon type="docs" size="small"/>Documentation</IconLink>
		<DotSeparator/>
		<IconLink href="https://github.com/geode-sdk"><Icon type="github" size="small"/>Source Code</IconLink>
	</Row>
	<Column>
		<section class="scroll-to-see">
			<Column>
				<Paragraph>
					Geode is a <em>fan-made extension</em> for Geometry Dash that adds <em>mod support</em> to the game. 
					Browse from an in-game list to seamlessly download mods on <em>Windows</em>, <em>Mac</em>, 
					<em>Android</em>, and <em>iOS</em>!
				</Paragraph>
				<span class="platform-icons">
					<Icon type="windows" size="big"/>
					<Icon type="mac" size="big"/>
					<Icon type="android" size="big"/>
					<Icon type="ios" size="big"/>
				</span>
			</Column>
			<ShowcaseCollage/>
		</section>
		<section class="scroll-to-see">
			<ModCollage/>
			<Column>
				<Paragraph>
					Geode is the <em>most popular</em> GD mod loader across all platforms. With an <em>active community</em> of 
					both users and modders, nearly every mod you can imagine has been made or suggested!
				</Paragraph>
				<Row>
					<MoneyBox num={1854082}><Icon type="download"/> <number-here /> downloads</MoneyBox>
					<MoneyBox num={103}><Icon type="graph"/> <number-here />  mods published</MoneyBox>
				</Row>
			</Column>
		</section>
		<section class="scroll-to-see">
			<Column>
				<Paragraph>
					Geode is <em>open-source</em> and is designed to make the modding experience infinitely smoother for 
					developers. Geode comes with a <em>special hooking syntax</em> as well as dozens of built-in 
					<em>UI components</em>, <em>utility functions</em>, and everything else needed to make mods.
				</Paragraph>
				<Row>
					<Button href="https://docs.geode-sdk.org/" type="filled">
						<Icon type="docs"/>Documentation
					</Button>
					<Button href="https://github.com/geode-sdk/examples/">
						<Icon type="examples"/>Examples
					</Button>
				</Row>
			</Column>
			<CodeExample code={`
				// Include Geode headers
				#include <Geode/modify/MenuLayer.hpp>;
				
				using namespace geode::prelude;
				
				// Add hooks to the main menu
				class $modify(MenuLayer) {
					// Override the main menu creation
					bool init() {
						// Start off by creating the original main menu
						if (!MenuLayer::init())
							return false;
						
						// We are now modding!
						log::info("Hi from my mod!");
				
						return true;
					}
				};
			`} />
		</section>
		<section class="scroll-to-see">
			<Column>
				<Paragraph>
					Interested? Go to the <em>Installation Page</em> to download Geode for your device, or the 
					<em>Mods Browser</em> to view what mods Geode has to offer!
				</Paragraph>
				<Row>
					<Button href="/install" type="primary filled"><Icon type="download"/>Install</Button>
					<Button href="/mods" type="primary filled"><Icon type="browse"/>Browse Mods</Button>
				</Row>
			</Column>
		</section>
	</Column>
	<Gap size="immense"/>
	<Column>
		<Row>
			<IconLink href="https://discord.gg/9e43WMKzhp" style="subtitle black">
				<Icon type="discord" size="small"/>Discord
			</IconLink>
			<DotSeparator style="black"/>
			<IconLink href="https://twitter.com/geode_sdk" style="subtitle black">
				<Icon type="twitter" size="small"/>Twitter
			</IconLink>
			<DotSeparator style="black"/>
			<IconLink href="https://docs.geode-sdk.org/" style="subtitle black">
				<Icon type="docs" size="small"/>Documentation
			</IconLink>
			<DotSeparator style="black"/>
			<IconLink href="https://github.com/geode-sdk" style="subtitle black">
				<Icon type="github" size="small"/>Source Code
			</IconLink>
		</Row>
		<Paragraph style="black">
			Site made by <Link href="https://github.com/hjfod" style="black">HJfod</Link>.
			Thank you to <Link href="https://github.com/nekitdev" style="black">Nekit</Link> for the domain!
		</Paragraph>
		<Row gap="small">
			<Icon type="copyright"/> 
			<Paragraph style="black">Geode Team 2024</Paragraph>
		</Row>
	</Column>
	<Waves height="35rem" size="few"/>
</Base>

<script>
	function triggerChildShowEvents(target: Element, shouldShow: boolean) {
		target.dispatchEvent(new Event(shouldShow ? 'geode-shown' : 'geode-hidden'));
		for (const child of target.children) {
			triggerChildShowEvents(child, shouldShow);
		}
	}
	const observer = new IntersectionObserver(entries => {
		entries.reverse().forEach(entry => {
			const shouldShow = entry.isIntersecting || entry.boundingClientRect.top < (entry.rootBounds?.top ?? 0);
			if (shouldShow) {
				entry.target.classList.toggle('show', shouldShow);
				triggerChildShowEvents(entry.target, shouldShow);
			}
		});
	}, {
		threshold: 0.65
	});
	document.querySelectorAll('.scroll-to-see').forEach(section => {
		observer.observe(section);
	});
</script>

<style lang="scss">
	span.platform-icons {
		display: flex;
		flex-direction: row;
		gap: .75rem;
		color: var(--accent-300);
        filter: drop-shadow(0px 0px .5rem color-mix(in srgb, var(--primary-500) 25%, transparent));
	}
	section {
		display: flex;
		flex-direction: row;
		align-items: center;
		padding-top: 5rem;
		padding-bottom: 5rem;
		gap: 4rem;
		font-size: 1.1em;
	}
	.scroll-to-see {
		opacity: 0%;
		transform: translateX(-10rem);
		transition-property: transform opacity;
		transition-duration: .6s;
		transition-timing-function: cubic-bezier(0.22, 1, 0.36, 1);
	}
	.scroll-to-see:nth-child(even) {
		transform: translateX(10rem);
	}
	.scroll-to-see.show {
		transform: translateX(0rem);
		opacity: 100%;
	}
</style>
